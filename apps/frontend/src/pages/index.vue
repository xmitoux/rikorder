<!-- 🏠️ホーム画面 -->
<script setup lang="ts">
import type { RikoImageEntityResponse } from '@repo/db';

const store = useRikordModeStore();
const { currentRikordMode } = storeToRefs(store);

const rikoImages = ref<RikoImageEntityResponse[] | null>([]);
const favoriteRikoImages = ref<RikoImageEntityResponse[]>([]);

watchEffect(async () => {
  const fetchRikoImages = findRikoImagesByRikordModeIdApi(currentRikordMode.value.id).catch(() => {
    console.error('画像選択画面用の画像取得に失敗しました。');
    return [];
  });

  const fetchFavoriteRikoImages = findFavoriteRikoImagesApi(currentRikordMode.value.id).catch(() => {
    console.error('お気に入り画像取得に失敗しました。');
    return [];
  });

  const [rikoImagesResult, favoriteRikoImagesResult] = await Promise.all([fetchRikoImages, fetchFavoriteRikoImages]);
  rikoImages.value = rikoImagesResult;
  favoriteRikoImages.value = favoriteRikoImagesResult;
});

const favoriteStart = ref(false);
const selectedFavoriteImage = ref<RikoImageEntityResponse | undefined>();
function selectFavoriteImage(selectedImage: RikoImageEntityResponse) {
  selectedFavoriteImage.value = selectedImage;
  favoriteStart.value = true;
}

const quickStart = ref(false);
const selectionStart = ref(false);
</script>

<template>
  <div>
    <!-- 情報エリア -->
    <!-- TODO: コンポーネント化 -->
    <div class="q-ml-sm q-mb-lg">
      <UISectionLabel class="q-mb-md" label="情報" />

      <!-- q-cardのborder-radius変更用にdivで囲む -->
      <div class="q-mb-lg card-border-radius">
        <q-card bordered class="q-py-sm bg-pink-1 no-border border-radius-inherit" flat>
          <q-card-section horizontal>
            <q-card-section class="col-6 q-px-sm q-py-sm text-center">
              <UILabelChip label="前回日時/目標" />

              <div class="q-mb-xs text-h6">
                9/19(木) 9:19
              </div>

              <div>
                9時間19分 経過
              </div>
            </q-card-section>

            <q-separator inset vertical />

            <q-card-section class="col-6 q-px-sm q-py-sm text-center">
              <UILabelChip label="今月回数" />

              <div class="q-mt-sm text-h6">
                19回
              </div>
            </q-card-section>
          </q-card-section>

          <q-separator inset />

          <q-card-section class="q-px-sm q-py-sm text-center">
            <UILabelChip label="今月の記録/目標" />

            <div class="text-h6">
              19回 / 919回
            </div>
          </q-card-section>
        </q-card>
      </div>
    </div>

    <!-- お気に入り -->
    <div class="q-ml-sm q-mb-lg">
      <UISectionLabel class="q-mb-md" label="お気に入りで始める" />
      <RikordFavoriteSelector v-if="favoriteRikoImages" :riko-images="favoriteRikoImages" @select="selectFavoriteImage" />
    </div>

    <div class="column q-px-xl">
      <UIButtonOk class="q-my-sm" label="今すぐ始める" @click="quickStart = true" />
      <UIButtonOk class="q-my-sm" label="選んで始める" @click="selectionStart = true" />
      <UIButtonOk class="q-my-sm" label="ランダム" />
    </div>

    <RikordDialogFavoriteStart v-if="selectedFavoriteImage" v-model:show="favoriteStart" :riko-image="selectedFavoriteImage!" />
    <RikordDialogQuickStart v-if="rikoImages" v-model:show="quickStart" :riko-images="rikoImages!" />
    <RikordDialogSelectionStart v-if="rikoImages" v-model:show="selectionStart" :riko-images="rikoImages!" />
  </div>
</template>

<style scoped lang="scss">
.card-border-radius {
  border-radius: 10px;
}
</style>
